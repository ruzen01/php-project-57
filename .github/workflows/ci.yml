        name: Laravel CI

        on:
          push:
            branches:
              - main  # Запускать CI при пуше в основную ветку (можно указать другую ветку)
          pull_request:
            branches:
              - main  # Запускать CI при создании pull request в основную ветку

        jobs:
          test:

            runs-on: ubuntu-latest

            services:
              mysql:
                image: mysql:8
                env:
                  MYSQL_ROOT_PASSWORD: password
                  MYSQL_DATABASE: testing_db
                options: >-
                  --health-cmd="mysqladmin ping --silent"
                  --health-interval=10s
                  --health-timeout=5s
                  --health-retries=3
                ports:
                  - 3306:3306
                volumes:
                  - /var/lib/mysql
                options: --character-set-server=utf8mb4 --collation-server=utf8mb4_unicode_ci

            steps:
              - name: Checkout code
                uses: actions/checkout@v3

              - name: Set up PHP
                uses: shivammathur/setup-php@v2
                with:
                  php-version: 8.1  # Укажите вашу версию PHP
                  extensions: mbstring, bcmath, pdo_mysql
                  coverage: none

              - name: Install Composer dependencies
                run: composer install --prefer-dist --no-progress --no-suggest --ansi

              - name: Copy .env.example to .env
                run: cp .env.example .env

              - name: Generate application key
                run: php artisan key:generate

              - name: Create database
                run: |
                  php artisan migrate --env=testing

              - name: Run tests
                run: php artisan test --env=testing

          lint:
            runs-on: ubuntu-latest

            steps:
              - name: Checkout code
                uses: actions/checkout@v3

              - name: Set up PHP
                uses: shivammathur/setup-php@v2
                with:
                  php-version: 8.1  # Укажите вашу версию PHP

              - name: Install Composer dependencies
                run: composer install --prefer-dist --no-progress --no-suggest --ansi

              - name: Run PHP CS Fixer (Lint)
                run: vendor/bin/php-cs-fixer fix --dry-run --diff